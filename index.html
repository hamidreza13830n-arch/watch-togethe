<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Watch Together</title>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<style>
body{
  margin:0;
  background:#0f0f0f;
  font-family:Arial;
  color:white;
  height:100vh;
  display:flex;
  flex-direction:column;
}

header{
  background:#111;
  padding:12px;
  display:flex;
  justify-content:space-between;
  font-weight:bold;
}

.main{
  flex:1;
  display:flex;
  flex-direction:column;
}

/* ğŸ¬ ÙÛŒÙ„Ù… Ø¹Ø±ÛŒØ¶â€ŒØªØ± */
.video-container{
  flex:1.6; /* Ø¨Ø²Ø±Ú¯â€ŒØªØ± Ø´Ø¯ */
  background:black;
  display:flex;
  flex-direction:column;
  gap:8px;
  padding:10px;
}

.link-bar{
  display:flex;
  gap:8px;
}

.link-bar input{
  flex:1;
  padding:10px 12px;
  border-radius:18px;
  border:none;
}

.link-bar button{
  padding:10px 14px;
  border:none;
  border-radius:18px;
  background:#e50914;
  color:white;
  font-weight:bold;
}

video{
  width:100%;
  height:100%;
  border-radius:12px;
  background:black;
}

/* Ú©Ù†ØªØ±Ù„ Ø³Ø±Ø¹Øª */
.speed-control{
  display:flex;
  justify-content:flex-end;
}

.speed-control select{
  padding:6px 10px;
  border-radius:10px;
  border:none;
}

/* ğŸ’¬ Ú†Øª */
.chat-container{
  flex:1;
  display:flex;
  flex-direction:column;
  padding:10px 15px 20px 15px;
}

.chat-box{
  flex:1;
  overflow-y:auto;
  display:flex;
  flex-direction:column;
  gap:8px;
}

.message{
  max-width:80%;
  padding:10px 14px;
  border-radius:15px;
  font-size:14px;
  position:relative;
  cursor:pointer;
}

.my-message{
  align-self:flex-end;
  background:#0088cc;
  border-bottom-right-radius:4px;
}

.other-message{
  align-self:flex-start;
  background:#262626;
  border-bottom-left-radius:4px;
}

.meta{
  display:flex;
  justify-content:flex-end;
  gap:6px;
  font-size:11px;
  opacity:0.7;
  margin-top:4px;
}

.reactions{
  margin-top:6px;
  font-size:16px;
}

.reaction-picker{
  position:absolute;
  bottom:100%;
  right:0;
  background:#1f1f1f;
  padding:6px 10px;
  border-radius:18px;
  display:flex;
  gap:6px;
  box-shadow:0 0 10px rgba(0,0,0,0.6);
}

.other-message .reaction-picker{
  right:auto;
  left:0;
}

.reaction-picker span{
  cursor:pointer;
  font-size:18px;
}

.input-area{
  display:flex;
  gap:8px;
  margin-top:8px;
}

.input-area input{
  flex:1;
  padding:10px;
  border-radius:20px;
  border:none;
}

.input-area button{
  padding:10px 16px;
  border:none;
  border-radius:20px;
  background:#e50914;
  color:white;
  font-weight:bold;
}

/* Ø­Ø§Ù„Øª Ø§ÙÙ‚ÛŒ */
@media (orientation: landscape){
  .main{ flex-direction:row; }
  .video-container{ flex:1.7; }
  .chat-container{ flex:1; }
}
</style>
</head>

<body>

<header>
  <span>ğŸ¬ Ø¨Ø§ Ù‡Ù… ØªÙ…Ø§Ø´Ø§ Ú©Ù†ÛŒØ¯</span>
  <span id="onlineCount">Online: 1</span>
</header>

<div class="main">

  <div class="video-container">
    <div class="link-bar">
      <input id="movieLink" placeholder="Paste mp4 link...">
      <button onclick="loadVideo()">Load</button>
    </div>

    <video id="video" controls></video>

    <div class="speed-control">
      <select onchange="changeSpeed(this.value)">
        <option value="0.5">0.5x</option>
        <option value="1" selected>1x</option>
        <option value="1.5">1.5x</option>
        <option value="2">2x</option>
      </select>
    </div>
  </div>

  <div class="chat-container">
    <div class="chat-box" id="chat"></div>

    <div class="input-area">
      <input id="message" placeholder="Message">
      <button onclick="sendMessage()">Send</button>
    </div>
  </div>

</div>

<script>
var firebaseConfig={
  apiKey:"AIzaSyCDHmmKIYPHDyvx4BXTb-7VP6lmVb8BCYw",
  authDomain:"film-online-922c1.firebaseapp.com",
  databaseURL:"https://film-online-922c1-default-rtdb.firebaseio.com/",
  projectId:"film-online-922c1"
};

firebase.initializeApp(firebaseConfig);
var db=firebase.database();
var video=document.getElementById("video");

/* Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø± ÙÙ‚Ø· ÛŒÚ©Ø¨Ø§Ø± */
if(!localStorage.getItem("username")){
  localStorage.setItem("username",prompt("Your name?")||"Guest");
}
var currentUser=localStorage.getItem("username");

/* Ø¢Ù†Ù„Ø§ÛŒÙ† */
var userId=Math.random().toString(36).substr(2,9);
var userRef=db.ref("onlineUsers/"+userId);
userRef.set(true);
userRef.onDisconnect().remove();

db.ref("onlineUsers").on("value",snap=>{
  document.getElementById("onlineCount").innerText=
  "Online: "+snap.numChildren();
});

/* Ù¾Ø§Ú© Ø´Ø¯Ù† Ú†Øª Ù‡Ù†Ú¯Ø§Ù… ÙˆØ±ÙˆØ¯ */
db.ref("chat").remove();

/* ÙˆÛŒØ¯ÛŒÙˆ */
function loadVideo(){
  var link=document.getElementById("movieLink").value;
  db.ref("video/link").set(link);
}

db.ref("video/link").on("value",snap=>{
  if(snap.val()) video.src=snap.val();
});

function changeSpeed(speed){
  video.playbackRate=speed;
}

/* Ø§Ø±Ø³Ø§Ù„ Ù¾ÛŒØ§Ù… */
function sendMessage(){
  var msg=document.getElementById("message").value;
  if(!msg) return;

  var now=new Date();
  var time=now.getHours().toString().padStart(2,'0')+
           ":"+
           now.getMinutes().toString().padStart(2,'0');

  db.ref("chat").push({
    user:currentUser,
    text:msg,
    time:time,
    seen:false,
    reactions:{}
  });

  document.getElementById("message").value="";
}

/* Ù†Ù…Ø§ÛŒØ´ Ù¾ÛŒØ§Ù… */
db.ref("chat").on("child_added",snap=>{
  var data=snap.val();
  var key=snap.key;

  if(data.user!==currentUser){
    db.ref("chat/"+key+"/seen").set(true);
  }

  var div=document.createElement("div");
  var mine=data.user===currentUser;

  div.className="message "+(mine?"my-message":"other-message");
  div.innerHTML=`
    <div>${data.text}</div>
    <div class="reactions" id="react-${key}"></div>
    <div class="meta">
      <span>${data.time}</span>
      ${mine?`<span id="seen-${key}">âœ”</span>`:""}
    </div>
  `;

  div.onclick=()=>showPicker(div,key);

  document.getElementById("chat").appendChild(div);

  if(mine){
    db.ref("chat/"+key+"/seen").on("value",s=>{
      document.getElementById("seen-"+key).innerText=
      s.val()?"âœ”âœ”":"âœ”";
    });
  }

  db.ref("chat/"+key+"/reactions").on("value",r=>{
    var container=document.getElementById("react-"+key);
    container.innerHTML="";
    if(r.val()){
      Object.values(r.val()).forEach(e=>{
        container.innerHTML+=e+" ";
      });
    }
  });
});

/* Ø±ÛŒâ€ŒØ§Ú©Ø´Ù† */
function showPicker(messageDiv,key){
  if(messageDiv.querySelector(".reaction-picker")) return;

  var picker=document.createElement("div");
  picker.className="reaction-picker";

  ["ğŸ˜","ğŸ˜","ğŸ¤£","â¤ï¸","ğŸ‘Œ"].forEach(emoji=>{
    var span=document.createElement("span");
    span.innerText=emoji;
    span.onclick=(e)=>{
      e.stopPropagation();
      db.ref("chat/"+key+"/reactions/"+userId).set(emoji);
      picker.remove();
    };
    picker.appendChild(span);
  });

  messageDiv.appendChild(picker);

  setTimeout(()=>{
    document.addEventListener("click",()=>picker.remove(),{once:true});
  },10);
}
</script>

</body>
</html>
